"use strict";

const test = require('tap').test;
const DB = require('../lib');
const Item = require('../lib/collection/item').Item;
const { iterateReferences, getReferencedCollection } = require('../lib/collection/schema/utils');

test("DB", suite => {

  suite.test('should export all collections', t => {
    t.plan(98);
    var db = new DB({schema: {
      groups: {
        name: {type: String, unique: true, required: true}
      },
      roles: {
        role: {type: 'enum', index: true, required: true, enum: ['owner', 'admin', 'guest']},
        group: {hasOne: {collection: 'groups', hasMany: 'roles'}},
        users: {hasMany: {collection: 'users', hasMany: 'roles'}},
        rolesGroups: {unique: true, components: ['role', 'group']}
      },
      users: {
        login: {type: String, unique: true, required: true},
        email: String,
        firstName: String,
        lastName: String,
        nameEmail: ['lastName', 'firstName', 'email']
      }
    }});

    var badassesId    = "000000000000000000000001"
      , wimpsId       = "000000000000000000000002"
      , badassOwnerId = "000000000000000000000003"
      , badassAdminId = "000000000000000000000004"
      , badassGuestId = "000000000000000000000005"
      , wimpOwnerId   = "000000000000000000000006"
      , wimpAdminId   = "000000000000000000000007"
      , wimpGuestId   = "000000000000000000000008"
      , userids = (i) => ("00000000000000000000" + (1000 + i));

    var roles = db.collections.roles;
    var users = db.collections.users;
    var groups = db.collections.groups;

    db.stream.pipe(db.stream);

    return db.writable.then(db => {
      for(let [collection, value] of Item.unwrap(groups, {_id: badassesId, name: 'Badasses', roles: [
        {_id: badassOwnerId, role: 'owner', group: badassesId},
        {_id: badassAdminId, role: 'admin', group: badassesId},
        {_id: badassGuestId, role: 'guest', group: badassesId, users: [
          {_id: userids(3), login: "Badass MF", firstName: "Misha", lastName: "Zupenko", email: "zupenko@ru.net"},
          {_id: userids(7), login: "The Guest", firstName: "Clint", lastName: "Eastwood", email: "goahead@makemy.day"}
        ]}
      ]})) {
        if ('string' !== typeof value) collection.create(value);
      }

      for(let [collection, value] of Item.unwrap(users, {_id: userids(0), login: "Badass Numer Uno", roles: [
          {_id: wimpOwnerId, role: 'owner', group: {_id: wimpsId, name: 'Wimps'}},
          badassOwnerId,
          badassAdminId
        ], firstName: "Dżon", lastName: "Kowalski", email: "dzon@badasses.me"
      })) {
        if ('string' !== typeof value) collection.create(value);
      }

      for(let [collection, value] of Item.unwrap(roles, {_id: wimpAdminId, role: 'admin', group: wimpsId, users: [
          {_id: userids(4), login: "Whiny admin", lastName: "Kowalski"}
        ]
      })) {
        if ('string' !== typeof value) collection.create(value);
      }

      for(let [collection, value] of Item.unwrap(roles, {_id: wimpGuestId, role: 'guest', group: wimpsId, users: [
          {_id: userids(5), login: "Wimpy 1", firstName: "Foo", lastName: "Bar"},
          {_id: userids(6), login: "Whiny guest", firstName: "Foo", lastName: "Bar"},
          userids(7)
        ]
      })) {
        if ('string' !== typeof value) collection.create(value);
      }

      for(let [collection, value] of Item.unwrap(users, {_id: userids(1), login: "BOFH", roles: [
          badassAdminId
        ],firstName: "Suzuki", lastName: "Kowalski", email: "suzu@badasses.me"
      })) {
        if ('string' !== typeof value) collection.create(value);
      }

      for(let [collection, value] of Item.unwrap(users, {_id: userids(2), login: "LART user", roles: [
          badassAdminId
        ], firstName: "Suzuki", lastName: "Kowalski"
      })) {
        if ('string' !== typeof value) collection.create(value);
      }

      var unwrapped = Array.from(Item.unwrap(users, {login: 'xxx', firstName: 'A', lastName: 'Z', roles: [
        {role: 'guest', group: {name: 'G1'}},
        {role: 'admin', group: {name: 'G2'}},
      ]}));

      t.strictEquals(unwrapped.length, 5);
      t.strictEquals(unwrapped[0].length, 2);
      t.strictEquals(unwrapped[0][0], groups);
      t.strictEquals(unwrapped[1].length, 2);
      t.strictEquals(unwrapped[1][0], roles);
      t.strictEquals(unwrapped[2].length, 2);
      t.strictEquals(unwrapped[2][0], groups);
      t.strictEquals(unwrapped[3].length, 2);
      t.strictEquals(unwrapped[3][0], roles);
      t.strictEquals(unwrapped[4].length, 2);
      t.strictEquals(unwrapped[4][0], users);
      var g1id = unwrapped[0][1]._id;
      var rguestid = unwrapped[1][1]._id;
      var g2id = unwrapped[2][1]._id;
      var radminid = unwrapped[3][1]._id;
      var xxxid = unwrapped[4][1]._id;
      t.strictEquals(new Set([g1id, rguestid, g2id, radminid, xxxid]).size, 5);
      t.type(g1id, 'string');
      t.type(rguestid, 'string');
      t.type(g2id, 'string');
      t.type(radminid, 'string');
      t.type(xxxid, 'string');
      t.match(g1id, /^[0-9a-f]{24}$/);
      t.match(rguestid, /^[0-9a-f]{24}$/);
      t.match(g2id, /^[0-9a-f]{24}$/);
      t.match(radminid, /^[0-9a-f]{24}$/);
      t.match(xxxid, /^[0-9a-f]{24}$/);
      t.deepEquals(unwrapped[0][1], {_id: g1id, name: 'G1'});
      t.deepEquals(unwrapped[1][1], {_id: rguestid, role: 'guest', group: g1id});
      t.deepEquals(unwrapped[2][1], {_id: g2id, name: 'G2'});
      t.deepEquals(unwrapped[3][1], {_id: radminid, role: 'admin', group: g2id});
      t.deepEquals(unwrapped[4][1], {_id: xxxid, login: 'xxx', firstName: 'A', lastName: 'Z',
                                        roles: [rguestid, radminid]});

      t.strictSame(Array.from(iterateReferences(roles, {users: [userids(0), userids(1)], group: badassesId})),
        [[groups, badassesId],
         [users, userids(0)],
         [users, userids(1)]]);

      t.strictEquals(getReferencedCollection(roles, 'foo'), undefined);
      t.strictEquals(getReferencedCollection(roles, 'users'), users);
      t.strictEquals(getReferencedCollection(roles, 'group'), groups);

      return db.save().then(() => db);
    })
    .then(db => {
      t.strictEquals(groups.size, 2);
      t.strictEquals(groups.count(), 2);
      t.deepEquals(groups[badassesId].toJSON(), {_id: badassesId, name: 'Badasses', roles: [
        badassOwnerId, badassAdminId, badassGuestId]});
      t.deepEquals(groups[wimpsId].toJSON(), {_id: wimpsId, name: 'Wimps', roles: [
        wimpOwnerId, wimpAdminId, wimpGuestId]});

      t.strictEquals(roles.size, 6);
      t.strictEquals(roles.count(), 6);

      t.deepEquals(roles[badassOwnerId].toJSON(), {_id: badassOwnerId, role: 'owner', group: badassesId, users: [
        userids(0)]});
      t.deepEquals(roles[badassAdminId].toJSON(), {_id: badassAdminId, role: 'admin', group: badassesId, users: [
        userids(0), userids(1), userids(2)]});
      t.deepEquals(roles[badassGuestId].toJSON(), {_id: badassGuestId, role: 'guest', group: badassesId, users: [
        userids(3), userids(7)]});
      t.deepEquals(roles[wimpOwnerId].toJSON(), {_id: wimpOwnerId, role: 'owner', group: wimpsId, users: [
        userids(0)]});
      t.deepEquals(roles[wimpAdminId].toJSON(), {_id: wimpAdminId, role: 'admin', group: wimpsId, users: [
        userids(4)]});
      t.deepEquals(roles[wimpGuestId].toJSON(), {_id: wimpGuestId, role: 'guest', group: wimpsId, users: [
        userids(5), userids(6), userids(7)]});

      t.strictEquals(users.size, 8);
      t.strictEquals(users.count(), 8);

      t.deepEquals(users[userids(0)].toJSON(), {_id: userids(0), login: "Badass Numer Uno", roles: [wimpOwnerId, badassOwnerId, badassAdminId],
        firstName: "Dżon", lastName: "Kowalski", email: "dzon@badasses.me"});
      t.deepEquals(users[userids(1)].toJSON(), {_id: userids(1), login: "BOFH",             roles: [badassAdminId],
          firstName: "Suzuki", lastName: "Kowalski", email: "suzu@badasses.me"});
      t.deepEquals(users[userids(2)].toJSON(), {_id: userids(2), login: "LART user",        roles: [badassAdminId],
          firstName: "Suzuki", lastName: "Kowalski"});
      t.deepEquals(users[userids(3)].toJSON(), {_id: userids(3), login: "Badass MF",        roles: [badassGuestId],
          firstName: "Misha", lastName: "Zupenko", email: "zupenko@ru.net"});
      t.deepEquals(users[userids(4)].toJSON(), {_id: userids(4), login: "Whiny admin",      roles: [wimpAdminId],
          lastName: "Kowalski"});
      t.deepEquals(users[userids(5)].toJSON(), {_id: userids(5), login: "Wimpy 1",          roles: [wimpGuestId],
          firstName: "Foo", lastName: "Bar"});
      t.deepEquals(users[userids(6)].toJSON(), {_id: userids(6), login: "Whiny guest",      roles: [wimpGuestId],
          firstName: "Foo", lastName: "Bar"});
      t.deepEquals(users[userids(7)].toJSON(), {_id: userids(7), login: "The Guest",        roles: [badassGuestId, wimpGuestId],
          firstName: "Clint", lastName: "Eastwood", email: "goahead@makemy.day"});

      var group = db.collections.groups.by.name.get('Badasses');
      t.type(group, Item);
      var object = Item.toObject(group);
      t.deepEquals(object, group.toJSON());
      t.deepEquals(object, {_id: group._id, name: 'Badasses', roles: group.roles.pluck('_id').all()});
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]});
      t.strictEquals(Item.toObject(group, -1), group._id);
      t.strictEquals(Item.toObject(group, -1), badassesId);
      object = Item.toObject(group, 1);
      t.deepEquals(object, {_id: group._id, name: 'Badasses', roles: group.roles.map(role => role.toJSON()).all()});
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]}]});
      object = Item.toObject(group, 2);
      t.deepEquals(object, {_id: group._id, name: 'Badasses', roles: group.roles.map(role => Item.toObject(role, 1)).each(role => { role.group = group._id }).all()});
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 3);
      t.deepEquals(object, {_id: group._id, name: 'Badasses', roles: group.roles.map(role => Item.toObject(role, 2)).each(role => { role.group = group._id }).all()});
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 4);
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 5);
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 6);
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 7);
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});
      object = Item.toObject(group, 8);
      t.strictEquals(JSON.stringify(object), JSON.stringify(Item.toObject(group, Number.POSITIVE_INFINITY)));
      object = Item.toObject(group, Number.POSITIVE_INFINITY);
      t.deepEquals(object, {"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]});

      var role = db.collections.roles[wimpGuestId];
      var object = Item.toObject(role);
      t.deepEquals(object, role.toJSON());
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]});
      t.strictEquals(Item.toObject(role, -1), role._id);
      t.strictEquals(Item.toObject(role, -1), wimpGuestId);
      object = Item.toObject(role, 1);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 2);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 3);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 4);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 5);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 6);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 7);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 8);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});
      object = Item.toObject(role, 9);
      t.strictEquals(JSON.stringify(object), JSON.stringify(Item.toObject(role, Number.POSITIVE_INFINITY)));
      object = Item.toObject(role, Number.POSITIVE_INFINITY);
      t.deepEquals(object, {"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":[{"_id":"000000000000000000001000","roles":["000000000000000000000006",{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":["000000000000000000001000"]},"000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"}]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":[{"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"},{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]});

      var user = db.collections.users.by.login.get("Badass Numer Uno");
      var object = Item.toObject(user);
      t.deepEquals(object, user.toJSON());
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":["000000000000000000000006","000000000000000000000003","000000000000000000000004"],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      t.strictEquals(Item.toObject(user, -1), user._id);
      t.strictEquals(Item.toObject(user, -1), userids(0));
      object = Item.toObject(user, 1);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 2);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 3);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 4);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005","000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 5);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":["000000000000000000001003","000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":["000000000000000000001005","000000000000000000001006","000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 6);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003","000000000000000000000004","000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006","000000000000000000000007","000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 7);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000","000000000000000000001001","000000000000000000001002"]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":["000000000000000000001004"]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
      object = Item.toObject(user, 8);
      t.strictEquals(JSON.stringify(object), JSON.stringify(Item.toObject(user, Number.POSITIVE_INFINITY)));
      object = Item.toObject(user, Number.POSITIVE_INFINITY);
      t.deepEquals(object, {"_id":"000000000000000000001000","roles":[{"_id":"000000000000000000000006","role":"owner","group":{"_id":"000000000000000000000002","name":"Wimps","roles":["000000000000000000000006",{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},{"_id":"000000000000000000000008","role":"guest","group":"000000000000000000000002","users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001007","roles":[{"_id":"000000000000000000000005","role":"guest","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},"000000000000000000000005"]},"users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},"000000000000000000001007"]},"000000000000000000000008"],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000003","role":"owner","group":{"_id":"000000000000000000000001","name":"Badasses","roles":["000000000000000000000003",{"_id":"000000000000000000000004","role":"admin","group":"000000000000000000000001","users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]},{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000"]},{"_id":"000000000000000000000004","role":"admin","group":{"_id":"000000000000000000000001","name":"Badasses","roles":[{"_id":"000000000000000000000003","role":"owner","group":"000000000000000000000001","users":["000000000000000000001000"]},"000000000000000000000004",{"_id":"000000000000000000000005","role":"guest","group":"000000000000000000000001","users":[{"_id":"000000000000000000001003","roles":["000000000000000000000005"],"login":"Badass MF","lastName":"Zupenko","firstName":"Misha","email":"zupenko@ru.net"},{"_id":"000000000000000000001007","roles":["000000000000000000000005",{"_id":"000000000000000000000008","role":"guest","group":{"_id":"000000000000000000000002","name":"Wimps","roles":[{"_id":"000000000000000000000006","role":"owner","group":"000000000000000000000002","users":["000000000000000000001000"]},{"_id":"000000000000000000000007","role":"admin","group":"000000000000000000000002","users":[{"_id":"000000000000000000001004","roles":["000000000000000000000007"],"login":"Whiny admin","lastName":"Kowalski"}]},"000000000000000000000008"]},"users":[{"_id":"000000000000000000001005","roles":["000000000000000000000008"],"login":"Wimpy 1","lastName":"Bar","firstName":"Foo"},{"_id":"000000000000000000001006","roles":["000000000000000000000008"],"login":"Whiny guest","lastName":"Bar","firstName":"Foo"},"000000000000000000001007"]}],"login":"The Guest","lastName":"Eastwood","firstName":"Clint","email":"goahead@makemy.day"}]}]},"users":["000000000000000000001000",{"_id":"000000000000000000001001","roles":["000000000000000000000004"],"login":"BOFH","lastName":"Kowalski","firstName":"Suzuki","email":"suzu@badasses.me"},{"_id":"000000000000000000001002","roles":["000000000000000000000004"],"login":"LART user","lastName":"Kowalski","firstName":"Suzuki"}]}],"login":"Badass Numer Uno","lastName":"Kowalski","firstName":"Dżon","email":"dzon@badasses.me"});
    })
    .catch(t.threw);
  });

  suite.end();
});
